<div class="card">

    <p-toolbar class="mb-5">
        <ng-template pTemplate="left">
            <button pButton pRipple label="Ajouter" icon="pi pi-plus" class="p-button-primary mr-2 mb-2"
                (click)="openNew()"></button>
        </ng-template>
    </p-toolbar>

    <p-table #dt1 [value]="taskList()" dataKey="id" [rows]="10" [loading]="loading" [paginator]="true"
        [globalFilterFields]="['title', 'desccription', 'deadline', 'status', 'priority', 'assignee']">
        <ng-template #caption>
            <div class="flex justify-between items-center flex-column sm:flex-row">
                <button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash"
                    (click)="clear(dt1)"></button>
                <p-iconfield iconPosition="left" class="ml-auto">
                    <p-inputicon>
                        <i class="pi pi-search"></i>
                    </p-inputicon>
                    <input pInputText type="text" (input)="onGlobalFilter(dt1, $event)" placeholder="Search keyword" />
                </p-iconfield>
            </div>
        </ng-template>
        <ng-template #header>
            <tr>
                <th style="min-width: 12rem">
                    <div class="flex justify-between items-center">
                        Titre
                        <p-columnFilter type="text" field="title" display="menu"
                            placeholder="Search by name"></p-columnFilter>
                    </div>
                </th>
                <th style="min-width: 12rem">
                    <div class="flex justify-between items-center">
                        Description
                        <p-columnFilter type="text" field="desccription" display="menu" placeholder=""></p-columnFilter>
                    </div>
                </th>
                <th style="min-width: 14rem">
                    <div class="flex justify-between items-center">
                        Deadline
                        <p-columnFilter type="text" field="deadline" display="menu"></p-columnFilter>
                    </div>
                </th>
                <th style="min-width: 10rem">
                    <div class="flex justify-between items-center">
                        Priorite
                        <p-columnFilter type="text" field="priority" display="menu"
                           ></p-columnFilter>
                    </div>
                </th>
                <th style="min-width: 10rem">
                    <div class="flex justify-between items-center">
                        Statut
                        <p-columnFilter type="text" field="status" display="menu"
                            placeholder="mm/dd/yyyy"></p-columnFilter>
                    </div>
                </th>
                <th style="min-width: 10rem">
                    <div class="flex justify-between items-center">
                        Assignee
                        <p-columnFilter type="text" field="assignee" display="meny"></p-columnFilter>
                    </div>
                </th>
                <th style="min-width: 12rem">
                    <div class="flex justify-between items-center">
                        Actions
                    </div>
                </th>

            </tr>
        </ng-template>
        <ng-template #body let-item>
            <tr>
                <td>{{ item.title }}</td>
                <td>{{ item.description }}</td>
                <td>{{ item.deadline | date: 'dd/MM/yyyy hh:mm' }}</td>
                <td> 
                    <p-tag [value]="item?.priority" [severity]="getPriority(item.priority)"></p-tag>
                
                </td>
                <td> 
                    <p-tag [value]="item?.status" [severity]="getSeverity(item.status)"></p-tag>
                
                </td>
                <td>{{ item.user?.fistName }}  {{ item.user?.lastName }}</td>
                <td>
                    <button pButton type="button" icon="pi pi-pencil"
                        class="p-button-rounded p-button-success mr-2" (click)="editData(item)" ></button>
                    <button pButton type="button" icon="pi pi-trash" class="p-button-rounded p-button-warning"></button>
                </td>
            </tr>
        </ng-template>
        <ng-template #emptymessage>
            <tr>
                <td colspan="8">No Item found.</td>
            </tr>
        </ng-template>
        <ng-template #loadingbody>
            <tr>
                <td colspan="8">Loading data. Please wait.</td>
            </tr>
        </ng-template>
    </p-table>

</div>

<p-dialog [(visible)]="displayDialog" [style]="{ width: '30%' }" header="Détails" [modal]="true" styleClass="p-fluid">
    <ng-template #content>
        <p-fluid class="grid gap-8">
            <div class="field">
                <label for="name" class="font-medium text-900">Titre</label>
                <input type="text" pInputText id="name" [(ngModel)]="createTask.title" required autofocus />
                <small class="p-error" *ngIf="submitted && !createTask.title">Le titre est requis.</small>
            </div>
            <div class="field">
                <label for="status" class="font-medium text-900">Statut</label>
                <p-select [(ngModel)]="createTask.status" [options]="statusList" optionValue="value" optionLabel="title"
                    placeholder="Select" />
                <small class="p-error" *ngIf="submitted && !createTask.status">La zone est requise.</small>
            </div>
             <div class="field">
                <label for="p" class="font-medium text-900">Utilisateur assignee</label>
                <p-select [(ngModel)]="createTask.userId" [options]="userList()"  optionLabel="firstName" optionValue="id"
                    placeholder="Selectionner un utilisateur"/>
                <small class="p-error" *ngIf="submitted && !createTask.status">Le chargé de la tâche est requise.</small>
            </div>
            <div class="field">
                <label for="usersList" class="font-medium text-900">Type priorite</label>
                <p-select [(ngModel)]="createTask.priority" [options]="priorityList"  optionLabel="title" optionValue="value"
                    placeholder="Select" />
                <small class="p-error" *ngIf="submitted && !createTask.priority">Le priorite est a précisée.</small>
            </div>
            <div class="field">
                <label for="description" class="font-medium text-900">Description</label>
                <textarea pInputTextarea id="description" class="w-full" rows="7" variant="filled"
                    [(ngModel)]="createTask.description"></textarea>
                <small class="p-error" *ngIf="submitted && !createTask.description">La description est
                    requise.</small>
            </div>
            <div class="field">
                <label for="date" class="font-medium text-900">Deadline</label>
                            <p-datepicker [(ngModel)]="createTask.deadline" [minDate]="currentDate" [showIcon]="true" inputId="buttondisplay" [showOnFocus]="false" />
                <small class="p-error" *ngIf="submitted && !createTask.deadline">La deadline est
                    requise.</small>
            </div>
        </p-fluid>


    </ng-template>

    <ng-template #footer>
        <button pButton pRipple label="Annuler" icon="pi pi-times" class="p-button-text"
            (click)="hideDialog()"></button>
        <button pButton pRipple label="Enregistrer" icon="pi pi-check" class="p-button-text"
            (click)="saveData()"></button>
    </ng-template>
</p-dialog>
<p-confirmDialog [style]="{ width: '450px' }" acceptLabel="Oui" rejectLabel="Non"></p-confirmDialog>

<p-toast />